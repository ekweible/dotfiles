#!/bin/bash
{{ if eq .chezmoi.os "darwin" -}}
# Install prerequisites needed for dotfiles
# This runs once before applying dotfiles

set -e

if ! command -v brew &> /dev/null; then
    echo "ðŸ“¦ Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

    # Setup brew in current shell
    if [[ -f "/opt/homebrew/bin/brew" ]]; then
        eval "$(/opt/homebrew/bin/brew shellenv)"
    elif [[ -f "/usr/local/bin/brew" ]]; then
        eval "$(/usr/local/bin/brew shellenv)"
    fi
else
    echo "âœ… Homebrew already installed"
fi

# Install age if not present (needed for encrypted files)
if ! command -v age &> /dev/null; then
    echo "ðŸ“¦ Installing age (needed for encrypted files)..."
    brew install age
else
    echo "âœ… age already installed"
fi
{{- end }}

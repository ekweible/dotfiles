#! /bin/sh

DEFAULT_CREATED=$(docker-machine ls | grep -c default)
if [ $DEFAULT_CREATED -eq 0 ]
then
  # The default docker machine does not exist. Warn and provide instructions
  # on how to fix this and then exit early.
  echo "WARNING: A 'default' docker machine does not exist."
  echo "Until one does, docker integration will not work."
  echo ""
  echo "Run the following command to create it:"
  echo ""
  echo "    docker-machine create default"
  echo ""
  return
fi

DEFAULT_STARTED=$(docker-machine ls --filter state=Running | grep -c default)
if [ $DEFAULT_STARTED -eq 0 ]
then
  # The default docker machine is not running. Attempt to start it now.
  echo "The 'default' docker machine is not running. Starting it now..."
  echo ""
  echo "$ docker-machine start default"
  docker-machine start default

  if [ $? -eq 0 ]
  then
    echo ""
    echo "Docker machine 'default' started successfully. " \
        "The 'docker-machine env' command will be evaluated automatically."
  else
    echo ""
    echo "Docker machine 'default' failed to start."
    echo "Docker integration will not work until this is resolved."
    return
  fi
fi

# Ensure the default docker machine's vars are in place.
eval $(docker-machine env default)
